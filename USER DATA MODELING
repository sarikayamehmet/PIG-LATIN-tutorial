-- loading event data

-- to find the count of rows
EVTDT= LOAD 'eventdata.csv' USING PigStorage(',') AS (EVTID,LAT,LONG);
EVTDT_GRP= GROUP EVTDT ALL;
EVT_COUNT = FOREACH EVTDT_GRP GENERATE COUNT(EVTDT);

-- to find count of unique evntID
EVTID = FOREACH EVTDT GENERATE EVTID;
DIST_EVTID = DISTINCT EVTID;
DIST_EVTID_GRP = GROUP DIST_EVTID ALL;
EVTID_COUNT = FOREACH DIST_EVTID_GRP GENERATE COUNT(DIST_EVTID);

-- USER DATA

-- to find the count of rows
USRDT= LOAD 'UserData.csv' USING PigStorage(',') AS (USRID,LAT,LONG);
USRDT_GRP= GROUP USRDT ALL;
USR_COUNT = FOREACH USRDT_GRP GENERATE COUNT(USRDT);

-- to find count of unique evntID
USRID = FOREACH USRDT GENERATE USRID;
DIST_USRID = DISTINCT USRID;
DIST_USRID_GRP = GROUP DIST_USRID ALL;
USRID_COUNT = FOREACH DIST_USRID_GRP GENERATE COUNT(DIST_USRID);

-- load USER RATINGS DATA
USRTG= LOAD 'UserRatings.csv' USING PigStorage(',') AS (USRID,EVTID,RTG);

-- USERRATINGS

-- consolidating UID,EID,RAT,ELAT,ELONG,ULAT,ULONG
EVTDT= LOAD 'eventdata.csv' USING PigStorage(',') AS (EVTID:INT,LAT:DOUBLE,LONG:DOUBLE);
USRDT= LOAD 'UserData.csv' USING PigStorage(',') AS (USRID:INT,LAT:DOUBLE,LONG:DOUBLE);
USRTG= LOAD 'UserRatings.csv' USING PigStorage(',') AS (USRID:INT,EVTID:INT,RTG:INT);
USRATT = LOAD 'AttendanceData.csv.csv' USING PigStorage(',') AS (USRID:INT,EVTID:INT,TOA:CHARARRAY);

USRTG_EVTLOC = JOIN USRTG BY USRTG.EVTID, EVTDT BY EVTDT.EVTID;
USRTG_EVTLOC_1 = FOREACH USRTG_EVTLOC GENERATE $0,$1,$2,$4,$5;

USRTG_USREVTLOC_1 = JOIN USRTG_EVTLOC_1 BY USRTG::USRID, USRDT BY USRID;
USRTG_USREVTLOC = FOREACH USRTG_USREVTLOC_1 GENERATE $0 AS USRID,$1 AS EVTID,$2 AS RATING,$3 AS EVT_LAT,$4 AS EVT_LONG,$6 AS USR_LAT,$7 AS USR_LONG;

-----
USR_EVT_GRP = GROUP USRTG_USREVTLOC BY USRID;



